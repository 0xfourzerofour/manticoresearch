––– input –––
yum install -y --skip-broken mariadb mariadb105 which > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
yum install -y -q https://repo.manticoresearch.com/manticore-repo.noarch.rpm > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
yum install -y -q manticore manticore-extra > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
yum install -y -q binutils > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
export current_version_searchd=$(searchd --version | head -n 1 | cut -d" " -f2); echo $current_version_searchd
––– output –––
%{SEMVER}
––– input –––
export current_version_columnar=$(searchd --version | head -n 1 | cut -d" " -f5); echo $current_version_columnar
––– output –––
%{SEMVER}
––– input –––
export current_version_secondary=$(searchd --version | head -n 1 | cut -d" " -f8); echo $current_version_secondary
––– output –––
%{SEMVER}
––– input –––
export current_version_knn=$(searchd --version | head -n 1 | cut -d" " -f11); echo $current_version_knn
––– output –––
––– input –––
export current_version_galera=$(strings /usr/share/manticore/modules/libgalera_manticore.so|grep -i -E "[0-9]{1}\.[0-9]{2}\([a-z0-9]+\)" | cut -d"(" -f1); echo $current_version_galera
––– output –––
#!/[0-9]{1}\.[0-9]{2}/!#
––– input –––
manticore-executor -v
––– output –––
PHP %{SEMVER} (cli) (built: #!/[a-zA-Z]{3}/!# #!/[0-9]+/!# %{YEAR} %{TIME}) (ZTS)
Copyright (c) The PHP Group
Zend Engine #!/v[0-9]+\.[0-9]+\.[0-9]+/!#, Copyright (c) Zend Technologies
––– block: start-searchd-release –––
––– block: check-buddy –––
––– block: check-backup –––
––– input –––
mysql -h0 -P9306 -e "SHOW STATUS LIKE 'version'\G" | grep -q "buddy" && export current_version_buddy=$(mysql -h0 -P9306 -e "SHOW STATUS LIKE 'version'\G" | awk -F'[ v()]+' '/buddy v/{print $(NF-1)}') || export current_version_buddy=''
––– output –––
––– input –––
yum -y --enablerepo manticore-dev update manticore manticore-extra manticore-common manticore-server manticore-server-core manticore-tools manticore-executor manticore-buddy manticore-backup manticore-columnar-lib manticore-server-core-debuginfo manticore-tools-debuginfo manticore-columnar-lib-debuginfo  manticore-icudata manticore-galera > /dev/null 2>&1; echo $?
––– output –––
0
––– input –––
searchd --stop
––– output –––
Manticore %{SEMVER} %{COMMITDATE} dev (columnar %{SEMVER} %{COMMITDATE}) (secondary %{SEMVER} %{COMMITDATE}) (knn %{SEMVER} %{COMMITDATE})
Copyright (c) 2001-2016, Andrew Aksyonoff
Copyright (c) 2008-2016, Sphinx Technologies Inc (http://sphinxsearch.com)
Copyright (c) 2017-%{YEAR}, Manticore Software LTD (https://manticoresearch.com)
[#!/[0-9]{2}:[0-9]{2}.[0-9]{3}/!#] [%{NUMBER}] using config file '%{PATH}' (%{NUMBER} chars)...
[#!/[0-9]{2}:[0-9]{2}.[0-9]{3}/!#] [%{NUMBER}] stop: successfully sent SIGTERM to pid %{NUMBER}
––– block: start-searchd-dev –––
––– input –––
export new_version_buddy=$(mysql -h0 -P9306 -e "SHOW STATUS LIKE 'version'\G" | awk -F'[ v()]+' '/buddy v/{print $(NF-1)}'); echo $new_version_buddy
––– output –––
#!/[0-9]{1}\.[0-9]{1}\.[0-9]{1}/!#
––– input –––
export new_version_searchd=$(searchd --version | head -n 1 | cut -d" " -f2); echo $new_version_searchd
––– output –––
%{SEMVER}
––– input –––
if [[ "$new_version_searchd" > "$current_version_searchd" ]]; then echo "Upgrade successful. New version searchd: $new_version_searchd"; else echo "Upgrade failed. Current version searchd: $current_version_searchd, new version: $new_version_searchd"; fi
––– output –––
Upgrade successful. New version searchd: %{SEMVER}
––– input –––
export new_version_columnar=$(searchd --version | head -n 1 | cut -d" " -f6); echo $new_version_columnar
––– output –––
%{SEMVER}
––– input –––
if [[ "$new_version_columnar" > "$current_version_columnar" ]]; then echo "Upgrade successful. New version columnar: $new_version_columnar"; else echo "Upgrade failed. Current version columnar: $current_version_columnar, new version: $new_version_columnar"; fi
––– output –––
Upgrade successful. New version columnar: %{SEMVER}
––– input –––
export new_version_secondary=$(searchd --version | head -n 1 | cut -d" " -f9); echo $new_version_secondary
––– output –––
%{SEMVER}
––– input –––
if [[ "$new_version_secondary" > "$current_version_secondary" ]]; then echo "Upgrade successful. New version secondary: $new_version_secondary"; else echo "Upgrade failed. Current version secondary: $current_version_knn, new version: $new_version_secondary"; fi
––– output –––
Upgrade successful. New version secondary: %{SEMVER}
––– input –––
export new_version_knn=$(searchd --version | head -n 1 | cut -d" " -f12); echo $new_version_knn
––– output –––
%{SEMVER}
––– input –––
if [[ "$new_version_knn" > "$current_version_knn" ]]; then echo "Upgrade successful. New version knn: $new_version_knn"; else echo "Upgrade failed. Current version knn: $current_version_knn, new version: $new_version_knn"; fi
––– output –––
Upgrade successful. New version knn: %{SEMVER}
––– input –––
export new_version_galera=$(strings /usr/share/manticore/modules/libgalera_manticore.so|grep -i -E "[0-9]{1}\.[0-9]{2}\([a-z0-9]+\)" | cut -d"(" -f1); echo $current_version_galera
––– output –––
#!/[0-9]{1}\.[0-9]{2}/!#
––– input –––
[[ "$(echo -e "$new_version_galera\n$current_version_galera" | sort -V | tail -n1)" == "$new_version_galera" ]] && echo "Upgrade successful. New version galera: $new_version_galera" || echo "Upgrade failed. Current version galera: $current_version_galera, new version: $new_version_galera"
––– output –––
Upgrade successful. New version galera: #!/[0-9]{1}\.[0-9]{2}/!#
––– input –––
export new_version_buddy=$(mysql -h0 -P9306 -e "SHOW STATUS LIKE 'version'\G" | awk -F'[ v()]+' '/buddy v/{print $(NF-1)}'); echo $new_version_buddy
––– output –––
#!/[0-9]{1}\.[0-9]{1}\.[0-9]{1}/!#
––– input –––
[[ "$(echo -e "$new_version_buddy\n$current_version_buddy" | sort -V | tail -n1)" == "$new_version_buddy" ]] && echo "Upgrade successful. New version buddy: $new_version_buddy" || echo "Upgrade failed. Current version buddy: $current_version_buddy, new version: $new_version_buddy"
––– output –––
Upgrade successful. New version buddy: #!/[0-9]{1}\.[0-9]{1}\.[0-9]{1}/!#
